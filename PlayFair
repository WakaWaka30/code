#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>


int CheckKey(char **keymat, char c, int x, int y){
    int i=0,j=0;
    
    for(i=0;i<x+1;i++){
        for(j=0;j<5;j++){
            
            if(*(*(keymat+i)+j) == c)
                break;
            else if(i == x && j == y)
                break;
            
        }
        if(*(*(keymat+i)+j) == c)
            break;
        else if(i == x && j == y)
            break;
        
    }
    if(i!=x || j != y)
        return 0;
    else
        return 1;
    
}

char** KeyMatGen(char *key1){
    char** keymat;
    char* key;
    int i=0,j=0,count=0,l,k;
    keymat = (char**)malloc(5*sizeof(char*));
    for(i=0;i<5;i++)
        *(keymat+i) = (char*)malloc(5*sizeof(char));
    for(i=0;i<strlen(key1);i++)
        if(*(key1+i) == 'J')
            count++;
    if(count == 0){
        key = (char*)malloc(strlen(key1)*sizeof(char));
        for(i=0;i<strlen(key1);i++)
            *(key+i) = *(key1+i);
        l = strlen(key);    
    }
    else{
        key = (char*)malloc((strlen(key1)-count)*sizeof(char));
        for(i=0;i<strlen(key1);i++){
            if(*(key1+i) != 'J')
                *(key+i) = *(key1+i);
            else  
                continue;
        }
        l = strlen(key);
    }        
    printf("%s\n",key);
    int r = (l/5)+1;
    int c = l%5;
    char ch;
    k=0;
    printf("%d--%d\n",r,c);
    for(i=0;i<r;i++)
        for(j=0;j<5;j++){
            *(*(keymat+i)+j) = *(key+k);
            //printf("%c\n",*(*(keymat+i)+j));
            k++;
        }
    
    
    k=65;
    
    for(i=r-1;i<5;i++){
        
        if(i == r-1){
            
            while(1){
                ch = (char)k;
                
                if(CheckKey(keymat,ch,i,j) == 1){
                    *(*(keymat+i)+3) = ch;
                    break;
                }
                else
                    k++;
            }
            k++;
            while(1){
                ch = (char)k;
                
                if(CheckKey(keymat,ch,i,j) == 1){
                    *(*(keymat+i)+4) = ch;
                    break;
                }
                else
                    k++;
            }
            
        }
        
        else{
            
            for(j=0;j<5;j++){
                while(1){
                    ch = (char)k;
                    
                    if(CheckKey(keymat,ch,i,j) == 1){
                        *(*(keymat+i)+j) = ch;
                        break;
                    }
                    else
                        k++;
                }
            
            }
            
        }
    }
    return keymat;        
            
    
}



int main(){
    char k[100];
    printf("Enter key: ");
    scanf("%s",k);
    int len = strlen(k);
    char* key1 = (char*)malloc(len*sizeof(char));
    int i=0,j=0;
    for(i=0;*(k+i)!='\0';i++)
        *(key1+i) = *(k+i);
    char** keyMat = KeyMatGen(key1);
    for(i=0;i<5;i++){
        for(j=0;j<5;j++)
            printf("%c\t",*(*(keyMat+i)+j));
        printf("\n");
    }
    return 0;
}
